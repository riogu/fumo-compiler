fn printf(format: char*, ...) -> i32;
namespace math {
    struct Point {
        let x: f64;
        let y: f64;
        
        fn distance_from_origin() -> f64 {
            return x * x + y * y;
        }
        fn static new(x: f64, y: f64) -> Point {
            return Point {x, y};
        }
        fn static origin() -> Point {
            return Point {0.0, 0.0};
        }
    }
    namespace utils {
        struct Stats {
            let count: i32;
            let sum: f64;
            
            fn add_value(val: f64) -> void {
                count = count + 1;
                sum = sum + val;
            }
            fn average() -> f64 {
                if count > 0 {
                    return sum / count;
                }
                return 0.0;
            }
            fn static new() -> Stats {
                return Stats {0, 0.0};
            }
        }
    }
}
let global_counter: i32 = 100;

fn process_any_data(data: any*, name: char*) -> void {
    if data {
        printf("Processing %s data at %p\n", name, data);
    } else {
        printf("No %s data provided\n", name);
    }
}

fn process_point(pt: math::Point*) -> void {
    printf("Point: (%.2f, %.2f)\n", pt->x, pt->y);
    
    if (let dist: f64 = pt->distance_from_origin()) {
        if dist > 25.0 {
            printf("Point is far from origin: %.2f\n", dist);
        } else {
            printf("Point is close to origin: %.2f\n", dist);
        }
    }
}

fn main() -> i32 {
    printf("Fumo language demonstration\n");
    
    // static constructors and initializer lists
    let point1 = math::Point::new(3.0, 4.0);
    let point2 = math::Point {1.5, 2.5};
    let origin = math::Point::origin();
    
    let stats = math::utils::Stats::new();
    let preset_stats = math::utils::Stats {2, 10.0};
    
    let i: i32 = 0;
    while i < 3 {
        if i == 0 {
            stats.add_value(point1.x);
        } else if i == 1 {
            stats.add_value(point1.y);
        } else {
            stats.add_value(point2.y);
        }
        i = i + 1;
    }
    
    process_point(&point1);
    process_point(&origin);
    
    // Demonstrate any* - generic data handling
    process_any_data(&point1, "point");
    process_any_data(&stats, "stats");
    process_any_data(null, "empty");
    
    printf("Stats average: %.2f\n", stats.average());
    printf("Preset average: %.2f\n", preset_stats.average());
    
    let ptr: i32* = &global_counter;
    printf("Global counter: %d\n", *ptr);
    
    return 0;
}
